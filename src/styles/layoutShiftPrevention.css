/* Layout Shift Prevention */

/* Mobile-specific layout shift prevention during page load */
@media (max-width: 768px) {
  body.mobile-loading *:not(.modal-overlay):not(.modal-content):not([class*="modal"]):not(.overlay) {
    animation-duration: 0s !important;
    transition-duration: 0s !important;
  }

  body.mobile-loading [data-framer-motion]:not(.modal-overlay):not(.modal-content):not([class*="modal"]):not(.overlay) {
    opacity: 1 !important;
    transform: none !important;
  }

  /* Prevent problematic Y transforms on mobile during load */
  body.mobile-loading .business-impact-hero *,
  body.mobile-loading .testimonials-section *,
  body.mobile-loading .pricing-section *,
  body.mobile-loading .process-timeline-section *,
  body.mobile-loading .resources-showcase * {
    transform: none !important;
    opacity: 1 !important;
  }
}

/* Touchscreen device optimizations */
@media (hover: none) and (pointer: coarse) {
  /* Reserve space for animated elements to prevent layout shift */
  .motion-div,
  [data-framer-motion] {
    min-height: 1px;
  }
  
  /* Reduce aggressive transforms on touch devices */
  .preview-card,
  .testimonial-card,
  .pricing-card {
    transform: none !important;
  }
}

/* Don't override scroll behavior - let main CSS handle it */

/* Ensure modals and overlays are never affected */
.modal-overlay,
.modal-content,
[class*="modal"],
.overlay {
  animation: unset !important;
  transition: unset !important;
  transform: unset !important;
  opacity: unset !important;
}

/* Minimal layout shift prevention - only for animated elements */
.hero-section *:not(.modal-overlay):not(.modal-content):not([class*="modal"]),
.process-timeline *:not(.modal-overlay):not(.modal-content):not([class*="modal"]),
.tiltable-card *:not(.modal-overlay):not(.modal-content):not([class*="modal"]) {
  transform-style: preserve-3d;
  backface-visibility: hidden;
}

/* Ensure elements reserve their space even when animated */
.motion-safe [data-motion] {
  will-change: transform, opacity;
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Page loading state */
body.loading {
  overflow: hidden;
}

body.loading * {
  animation-play-state: paused !important;
  transition-duration: 0ms !important;
}

/* Smooth scroll improvements */
html {
  scroll-behavior: smooth;
}

/* Prevent scroll anchoring issues during animations */
* {
  overflow-anchor: none;
}

/* Enhanced scroll behavior to prevent animation interference */
html {
  scroll-behavior: smooth;
  scroll-padding-top: 0;
}

body {
  scroll-behavior: smooth;
  overscroll-behavior: none;
}

/* Prevent scroll jacking from animations */
@media (prefers-reduced-motion: no-preference) {
  * {
    scroll-margin-top: 0;
    scroll-margin-bottom: 0;
  }
}

/* Ensure proper stacking context for animated elements */
.motion-element {
  position: relative;
  z-index: auto;
}

/* Prevent content from overlapping during scroll */
section {
  position: relative;
  z-index: 1;
  isolation: isolate;
}

/* Ensure main content areas maintain proper stacking */
.hero, .business-impact-hero,
.testimonials-section, .pricing-section,
.resources-showcase, .process-timeline-section {
  position: relative;
  z-index: 2;
  isolation: isolate;
}

/* Smooth scroll improvements for fast scrolling */
body * {
  -webkit-overflow-scrolling: touch;
}

/* Prevent momentum scrolling interruptions */
@media screen and (max-width: 768px) {
  body {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
  }
}

/* Layout reserved space for animated elements */
.animate-in-view {
  min-height: 1px; /* Ensures element takes space even when opacity: 0 */
}

/* Prevent flash of unstyled content */
.page-content {
  visibility: hidden;
}

.page-loaded .page-content {
  visibility: visible;
}

/* Smooth transitions for layout changes */
.layout-transition {
  transition: height 0.3s ease, min-height 0.3s ease;
}

/* GPU acceleration for smooth animations */
.gpu-accelerated {
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* Intersection Observer loading states */
.intersection-loading {
  opacity: 0.1;
  transform: none; /* Don't transform during loading */
}

.intersection-loaded {
  opacity: 1;
  transition: opacity 0.4s ease;
}

/* Mobile-specific improvements */
@media (max-width: 768px) {
  /* Reduce motion intensity on mobile */
  .motion-reduce-mobile {
    animation-duration: 0.2s !important;
    transition-duration: 0.2s !important;
  }
  
  /* Prevent iOS Safari bounce scrolling during animations */
  body.mobile-loading {
    position: fixed;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  
  /* Ensure smooth scrolling after load */
  body:not(.mobile-loading) {
    position: static;
    overflow-x: hidden;
    overflow-y: auto;
  }
  
  /* Optimize for mobile performance */
  .hero-section,
  .business-impact-hero {
    will-change: auto;
    contain: layout style;
  }
}

/* ELIMINATE INTERNAL CONTAINER SHIFTING - Fix content sliding within own boundaries */

/* Key Fix: Prevent Y-axis movements that create internal gaps */
section[id] {
  contain: layout style paint;
  transform: translateZ(0); 
  isolation: isolate;
}

/* Force all animations to use ONLY opacity (no Y movement) to prevent internal shifting */
section[id] motion\:div,
section[id] [data-framer-component],
.motion-div {
  will-change: opacity !important;
  contain: layout;
  transform: translateZ(0);
}

/* Override Y-axis animations globally to prevent content sliding */
motion\:div[style*="translateY"],
[style*="translateY"] {
  transform: translateY(0px) !important;
}

/* Fix container positioning for scroll offset calculations - MINIMAL APPROACH */
.timeline-container {
  position: relative;
}

/* Specific fixes for problematic components */
@media (max-width: 768px) {
  /* BusinessImpactHero mobile loading fixes */
  body.mobile-loading .hero-value-proposition:not(.modal-overlay):not(.modal-content),
  body.mobile-loading .hero-pricing-anchor:not(.modal-overlay):not(.modal-content),
  body.mobile-loading .preview-cards:not(.modal-overlay):not(.modal-content),
  body.mobile-loading .hero-cta-section:not(.modal-overlay):not(.modal-content) {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }
  
  /* Additional mobile loading fixes for staggered animations */
  body.mobile-loading .hero-value-proposition *:not(.modal-overlay):not(.modal-content),
  body.mobile-loading .hero-pricing-anchor *:not(.modal-overlay):not(.modal-content) {
    opacity: 1 !important;
    transform: translateY(0) translateX(0) scale(1) rotate(0deg) !important;
  }
  
  /* TestimonialsSection mobile loading fixes */
  body.mobile-loading .testimonial-card:not(.modal-overlay):not(.modal-content) {
    opacity: 1 !important;
    transform: translateY(0) scale(1) !important;
  }
  
  /* PricingSection mobile loading fixes */
  body.mobile-loading .pricing-card:not(.modal-overlay):not(.modal-content) {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }
  
  /* Ensure critical sections load smoothly on mobile */
  body.mobile-loading .resources-showcase .resource-card:not(.modal-overlay):not(.modal-content),
  body.mobile-loading .process-timeline .process-step:not(.modal-overlay):not(.modal-content) {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }
}