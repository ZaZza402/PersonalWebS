/* Layout Shift Prevention */

/* Mobile-specific layout shift prevention during page load */
@media (max-width: 768px) {
  body.mobile-loading *:not(.modal-overlay):not(.modal-content):not([class*="modal"]):not(.overlay) {
    animation-duration: 0s !important;
    transition-duration: 0s !important;
  }

  body.mobile-loading [data-framer-motion]:not(.modal-overlay):not(.modal-content):not([class*="modal"]):not(.overlay) {
    opacity: 1 !important;
    transform: none !important;
  }

  /* Prevent problematic Y transforms on mobile during load */
  body.mobile-loading .business-impact-hero *,
  body.mobile-loading .testimonials-section *,
  body.mobile-loading .pricing-section *,
  body.mobile-loading .process-timeline-section *,
  body.mobile-loading .resources-showcase * {
    transform: none !important;
    opacity: 1 !important;
  }
}

/* Touchscreen device optimizations */
@media (hover: none) and (pointer: coarse) {
  /* Reserve space for animated elements to prevent layout shift */
  .motion-div,
  [data-framer-motion] {
    min-height: 1px;
  }
  
  /* Reduce aggressive transforms on touch devices */
  .preview-card,
  .testimonial-card,
  .pricing-card {
    transform: none !important;
  }
}

/* Don't override scroll behavior - let main CSS handle it */

/* Ensure modals and overlays are never affected */
.modal-overlay,
.modal-content,
[class*="modal"],
.overlay {
  animation: unset !important;
  transition: unset !important;
  transform: unset !important;
  opacity: unset !important;
}

/* Minimal layout shift prevention - only for animated elements */
.hero-section *:not(.modal-overlay):not(.modal-content):not([class*="modal"]),
.process-timeline *:not(.modal-overlay):not(.modal-content):not([class*="modal"]),
.tiltable-card *:not(.modal-overlay):not(.modal-content):not([class*="modal"]) {
  transform-style: preserve-3d;
  backface-visibility: hidden;
}

/* Ensure elements reserve their space even when animated */
.motion-safe [data-motion] {
  will-change: transform, opacity;
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Page loading state */
body.loading {
  overflow: hidden;
}

body.loading * {
  animation-play-state: paused !important;
  transition-duration: 0ms !important;
}

/* Smooth scroll improvements */
html {
  scroll-behavior: smooth;
}

/* Prevent scroll anchoring issues during animations */
* {
  overflow-anchor: none;
}

/* Ensure proper stacking context for animated elements */
.motion-element {
  position: relative;
  z-index: auto;
}

/* Layout reserved space for animated elements */
.animate-in-view {
  min-height: 1px; /* Ensures element takes space even when opacity: 0 */
}

/* Prevent flash of unstyled content */
.page-content {
  visibility: hidden;
}

.page-loaded .page-content {
  visibility: visible;
}

/* Smooth transitions for layout changes */
.layout-transition {
  transition: height 0.3s ease, min-height 0.3s ease;
}

/* GPU acceleration for smooth animations */
.gpu-accelerated {
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* Intersection Observer loading states */
.intersection-loading {
  opacity: 0.1;
  transform: none; /* Don't transform during loading */
}

.intersection-loaded {
  opacity: 1;
  transition: opacity 0.4s ease;
}

/* Mobile-specific improvements */
@media (max-width: 768px) {
  /* Reduce motion intensity on mobile */
  .motion-reduce-mobile {
    animation-duration: 0.2s !important;
    transition-duration: 0.2s !important;
  }
  
  /* Prevent iOS Safari bounce scrolling during animations */
  body.mobile-loading {
    position: fixed;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  
  /* Ensure smooth scrolling after load */
  body:not(.mobile-loading) {
    position: static;
    overflow-x: hidden;
    overflow-y: auto;
  }
  
  /* Optimize for mobile performance */
  .hero-section,
  .business-impact-hero {
    will-change: auto;
    contain: layout style;
  }
}

/* Specific fixes for problematic components */
@media (max-width: 768px) {
  /* BusinessImpactHero mobile loading fixes */
  body.mobile-loading .hero-pricing-anchor:not(.modal-overlay):not(.modal-content),
  body.mobile-loading .preview-cards:not(.modal-overlay):not(.modal-content),
  body.mobile-loading .hero-cta-section:not(.modal-overlay):not(.modal-content) {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }
  
  /* TestimonialsSection mobile loading fixes */
  body.mobile-loading .testimonial-card:not(.modal-overlay):not(.modal-content) {
    opacity: 1 !important;
    transform: translateY(0) scale(1) !important;
  }
  
  /* PricingSection mobile loading fixes */
  body.mobile-loading .pricing-card:not(.modal-overlay):not(.modal-content) {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }
  
  /* Ensure critical sections load smoothly on mobile */
  body.mobile-loading .resources-showcase .resource-card:not(.modal-overlay):not(.modal-content),
  body.mobile-loading .process-timeline .process-step:not(.modal-overlay):not(.modal-content) {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }
}